<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>FastCuba - Premium Money Transfer</title>
    <link rel="icon" href="data:,">
    <link href="https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@300;400;600;800&display=swap" rel="stylesheet">
    <link rel="stylesheet" type="text/css" href="./css/index.css">
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
    <script src="./js/supabase.js"></script>
</head>
<body>

    <!-- Pantalla de Carga Profesional -->
<div id="loader-wrapper">
    <div class="loader-content">
        <div class="loader-brand">
            <h2>FastCuba</h2>
            <p>Premium Transfer</p>
        </div>

        <div class="loader-info-box">
            <span id="loader-status-text">Estableciendo conexi√≥n segura...</span>
            
            <div class="progress-container">
                <div class="progress-bar" id="main-progress-bar"></div>
            </div>
            
            <div style="display: flex; justify-content: space-between; align-items: center;">
                <span class="progress-percentage" id="progress-percent">0%</span>
                <span style="font-size: 10px; color: var(--text-secondary); text-transform: uppercase;">AES-256 Encryption</span>
            </div>

            <div class="loader-tips">
                <div class="tip-item active">Verificando tasas de cambio en tiempo real...</div>
                <div class="tip-item">Tus transferencias por Zelle est√°n protegidas.</div>
                <div class="tip-item">Soporte t√©cnico activo 24/7.</div>
                <div class="tip-item">M√°s de 5,000 env√≠os exitosos este mes.</div>
            </div>
        </div>
    </div>
</div>

<header>
    <h1>Fast üí± Cuba</h1>
    <p>Envia dinero a tus familiares en Cuba de la forma mas rapida.</p>

    <!-- Insertar dentro del <header> despu√©s de los <p> -->
<div class="hero-calculator">
    <div class="calc-card">
        <div class="calc-input-row">
            <div class="input-field">
                <label>T√∫ env√≠as (USD)</label>
                <input type="number" id="home-monto-usd" placeholder="100" min="50">
            </div>
            <div class="swap-icon">‚ûî</div>
            <div class="input-field">
                <label>Reciben en Cuba (CUP)</label>
                <input type="text" id="home-monto-cup" readonly placeholder="0.00">
            </div>
        </div>

        <div class="calc-details">
            <div class="detail-item">
                <span>Tasa de cambio:</span>
                <strong id="home-tasa-val">...</strong>
            </div>
            <div class="detail-item">
                <span>Comisi√≥n Zelle:</span>
                <strong id="home-comision-val">$0.00</strong>
            </div>
            <div class="detail-item total">
                <span>Total a pagar:</span>
                <strong id="home-total-pagar">$0.00</strong>
            </div>
        </div>
    </div>
</div>
</header>

<!-- Bot√≥n Flotante de Rastreo-->
<div class="fab" id="tracking-fab" onclick="abrirModalTracking()" title="Rastrear Env√≠o" style="bottom: 105px; background: #6c757d; font-size: 24px;">
    <span>üîç</span>
</div>

<!-- Bot√≥n Flotante con Burbuja -->
<div class="fab" id="main-fab" onclick="abrirModal()" title="Nuevo Env√≠o">
    <!-- Nueva burbuja de notificaci√≥n -->
    <div class="fab-badge-notification" id="fab-notification">
        Presiona aqu√≠ para iniciar tu transacci√≥n
    </div>
    <span>+</span>
</div>

<!-- Modal de Rastreo -->
<div class="modal-overlay" id="modalTracking">
    <div class="modal-content">
        <h2 style="margin-top:0; font-weight: 700;">Rastrear mi Env√≠o</h2>
        <p style="font-size:0.9rem; color: var(--text-secondary);">Ingresa tu n√∫mero de WhatsApp para ver el estado de tus transferencias recientes.</p>
        
        <div class="input-group">
            <label>N√∫mero de WhatsApp</label>
            <input type="text" id="search-input" placeholder="Ej: +1 123 456 7890">
        </div>
        
        <button type="button" class="btn btn-next" style="width:100%;" onclick="buscarTransaccion()">Buscar Ahora</button>
        
        <!-- Contenedor de Resultados -->
        <div id="tracking-results" style="margin-top: 25px; display: none;">
            <!-- Aqu√≠ se inyectar√°n las tarjetas de resultados -->
        </div>

        <button type="button" class="btn btn-cancel" style="width:100%; margin-top: 15px;" onclick="cerrarModalTracking()">Cerrar</button>
    </div>
</div>


<!-- Modal -->
<div class="modal-overlay" id="modalTransferencia">
    <div class="modal-content">
        
        <form id="form-transaccion">
            <!-- PASO 0: Informaci√≥n de Pago (NUEVO) -->
            <div class="step active" id="step-0">
    <h2 style="margin-top:0; font-weight:700;">
        Informaci√≥n de Pago
    </h2>

    <div style="font-size:0.9rem; color:var(--text-secondary); line-height:1.4;">
        <p>Para procesar tu env√≠o, sigue estos pasos:</p>

        <ol style="padding-left:1.2rem; margin:0.5rem 0 0 0;">
            <li>
                Primero debes realizar la transferencia por <strong>Zelle</strong> a la siguiente cuenta.
            </li>
            <li>
                Toma una captura de la confirmaci√≥n de la transferencia.
            </li>
            <li>
                Si ya realizaste la transferencia y tienes la captura, presiona <strong>Continuar</strong>.
            </li>
        </ol>
    </div>

    <div class="calc-box" style="text-align:center; border:1px dashed var(--primary); margin-top:15px;">
        <label>Cuenta Zelle Oficial</label>

        <div style="display:flex; align-items:center; justify-content:center; gap:10px; margin-top:10px;">
            <span id="zelle-account" style="font-size:1.2rem; font-weight:800; color:white;">
                pago@fastcuba.com
            </span>

            <button
                type="button"
                onclick="copiarZelle()"
                style="background:var(--primary); border:none; border-radius:8px; color:white; padding:5px 10px; cursor:pointer; font-size:0.8rem;">
                Copiar
            </button>
        </div>
    </div>

    <div class="nav-buttons" style="display:flex; gap:10px; margin-top:30px;">
        <button type="button" class="btn btn-cancel" onclick="cerrarModal()">
            Cerrar
        </button>
        <button type="button" class="btn btn-next" onclick="nextStep(1)">
            Continuar
        </button>
    </div>
</div>

            <!-- PASO 1: Datos del Remitente y Monto -->
            <div class="step" id="step-1">
                <h2 style="margin-top:0; font-weight: 700;">Monto y Remitente</h2>
                <div class="input-group">
                    <label for="monto_usd">Monto a enviar (USD)</label>
                    <input type="number" id="monto_usd" min="50" placeholder="M√≠nimo $50.00" required>
                </div>

                <div class="calc-box">
                    <div style="display:flex; justify-content:space-between; align-items: center; margin-bottom:10px;">
                        <span style="color: var(--text-secondary);">Beneficiario recibe:</span>
                        <strong style="color:var(--success); font-size: 1.2rem;" id="total_cup">0.00 CUP</strong>
                    </div>
                    <hr style="border: none; height: 1px; background: var(--glass-border); margin: 10px 0;">
                    <div style="display:flex; justify-content:space-between; align-items: center; font-size: 0.9rem; opacity: 0.9;">
                        <span>Total pagado (Zelle):</span>
                        <span id="total_usd" style="font-weight: 600;">$0.00</span>
                    </div>
                </div>

                <div class="input-group">
                    <label for="remitente_nombre">Tu Nombre Completo</label>
                    <input type="text" id="remitente_nombre" placeholder="Ej: Juan P√©rez" required>
                </div>
                <div class="input-group">
                    <label for="remitente_whatsapp">Tu WhatsApp</label>
                    <input type="text" id="remitente_whatsapp" placeholder="Ej: +1 123..." required>
                </div>

                <div class="nav-buttons" style="display:flex; gap:10px; margin-top: 30px;">
                    <button type="button" class="btn btn-prev" onclick="nextStep(0)">Atr√°s</button>
                    <button type="button" class="btn btn-next" onclick="nextStep(2)">Continuar</button>
                </div>
            </div>

            <!-- PASO 2: Datos del Beneficiario -->
            <div class="step" id="step-2">
                <h2 style="margin-top:0; font-weight: 700;">Datos del Destinatario</h2>
                <div class="input-group">
                    <label for="beneficiario_nombre">Nombre del Beneficiario</label>
                    <input type="text" id="beneficiario_nombre" required>
                </div>
                <div class="input-group">
                    <label for="beneficiario_provincia">Provincia</label>
                    <input type="text" id="beneficiario_provincia" required>
                </div>
                <div class="input-group">
                    <label for="beneficiario_whatsapp">WhatsApp (Opcional)</label>
                    <input type="text" id="beneficiario_whatsapp">
                </div>
                <div class="nav-buttons" style="display:flex; gap:10px; margin-top: 30px;">
                    <button type="button" class="btn btn-prev" onclick="nextStep(1)">Atr√°s</button>
                    <button type="button" class="btn btn-next" onclick="nextStep(3)">Siguiente</button>
                </div>
            </div>

            <!-- PASO 3: Comprobante -->
          <!-- Busca el Paso 3 en tu index.html y cambia el bot√≥n -->
<div class="step" id="step-3">
    <h2 style="margin-top:0; font-weight: 700;">Comprobante de Pago</h2>
    <p style="font-size:0.9rem; opacity:0.8; line-height: 1.5;">Sube una captura de pantalla de tu transferencia Zelle.</p>
    <div class="input-group" style="margin-top: 25px;">
        <label for="comprobante">Archivo de Imagen</label>
        <input type="file" id="comprobante" accept="image/*" required>
    </div>
    <div class="nav-buttons" style="display:flex; gap:10px; margin-top: 30px;">
        <button type="button" class="btn btn-prev" onclick="nextStep(2)">Atr√°s</button>
        
        <!-- CAMBIA ESTA L√çNEA: de type="submit" a type="button" y agrega el onclick -->
        <button type="button" id="btn-enviar" class="btn btn-next" onclick="procesarEnvioFinal()">Finalizar Env√≠o</button>
    </div>
</div>
        </form>
    </div>
</div>


<script src="./js/index.js"></script>

</body>
</html>